dependencies:
  pre:
    - bash .ci/install-perl.bash
    - bash .ci/install-cpanm.bash
    - bash .ci/install-carton.bash
    - which perl
    - which carton
    - perl -v

  override:
    - carton install

  cache_directories:
    - local
    - ~/.plenv

test:
  override:
    # unit tests
    - carton exec -- prove -r t/codecov

    # integration tests
    - |
      HARNESS_PERL_SWITCHES="-MDevel::Cover=+ignore,^t/Util.pm|^t/data/proj/t/|^local/" \
      carton exec -- prove -r t/data/proj/t
    - PERL5OPT=-Mlib=$PWD/lib carton exec -- cover -report codecov
